import{r as o,j as W,i as U,R as e,X as z,S as b,n as G,_ as x,k as ce,l as oe,a as $,o as B,g as H,h as E,I as P,B as C,C as ie,L as f}from"./index-CqUjVgox.js";import{T as R}from"./textarea-4hVXC_2N.js";import{B as q}from"./badge-B0N44wJb.js";import{T as me}from"./sonner-iBYa7rjY.js";import{w as _}from"./index-DLdLSjkK.js";import{M as K}from"./Modal-BImeYp_W.js";import{u as J,S as Y,i as X,g as V,C as pe,R as de}from"./extractFileNameFromImgUrl-DS_XfVoC.js";import{D as ue,a as ge,b as Ee,c as ye,d as he}from"./dialog-D93OiIH2.js";import"./warning-C20GYw-A.js";const Ne=async a=>{try{return await(await fetch(`${x.BACKEND_URL}/api/admin/get-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:a})})).json()}catch{throw new Error("cant get presigned url")}},fe=({ToggleModal:a})=>{const[s,c]=o.useState(),m=W(),n=U(r=>r.UploadedImgs.banners),y=async r=>{const p=`UI/product-banner/${G(12)}-${r[0].name}`;c(!0);try{const{url:i,key:A}=await Ne(p),I={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},d=await X(r[0],I);await(async()=>{if(!(await fetch(i,{method:"PUT",headers:{"Content-Type":r[0].type},body:d})).ok)throw new Error("Error during file upload");const h=`${x.IMAGE_CDN}/${p}`;console.log("Uploaded Image URL:",h),c(!1);const k={imgUrl:h,fileName:r[0].name,fileSize:d.size};m(ce(k))})()}catch(i){console.error("Upload Error:",i),c(!1)}},{acceptedFiles:S,getRootProps:v,getInputProps:w}=J({onDrop:y,accept:{"image/*":[]}});return e.createElement("div",{className:"lg:min-w-[800px] "},e.createElement("div",{className:"file_Upload__header border-b flex justify-between p-4"},e.createElement("h2",{className:"text-gray-600 text-2xl "},"Upload Banner Images"),e.createElement("span",{className:"close-icon hover:bg-gray-800 size-10 flex justify-center items-center rounded-full group ease-in duration-75 transition-colors",id:"modal-close",onClick:a},e.createElement(z,{className:"text-gray-300 size-8 cursor-pointer group-hover:text-white"}))),e.createElement("div",{className:"file-upload-wrapper px-4 my-4"},e.createElement("div",{...v({className:"dropzone"}),className:"rounded-md border-2 border-dashed mx-auto w-5/6 my-4 p-6 cursor-copy"},e.createElement("input",{...w()}),e.createElement("p",{className:"text-gray-300"},"Drag 'n' drop some files here, or click to select files")),s&&e.createElement("div",{className:"container border p-3 rounded-md transition-all ease-in mb-2"},e.createElement("div",{className:"flex items-center space-x-2"},e.createElement(b,{className:"h-12 w-12 rounded-md"}),e.createElement("div",{className:"space-y-2"},e.createElement(b,{className:"h-4 w-[250px]"}),e.createElement(b,{className:"h-4 w-[50px]"})))),e.createElement("div",{className:"flex flex-col gap-2"},n&&n.length>=0&&n.map(r=>e.createElement(Y,{File:r,Size:r.fileSize,key:r.id,ImgUrl:r.imgUrl,ISUploading:s})))))},be=async a=>{try{return await(await fetch(`${x.BACKEND_URL}/api/admin/get-presigned-url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:a})})).json()}catch{throw new Error("cant get presigned url")}},xe=({ToggleModal:a})=>{const[s,c]=o.useState(),m=W(),n=U(r=>r.UploadedImgs.productImages),y=async r=>{const p=`UI/product-Img/${G(12)}-${r[0].name}`;c(!0);try{const{url:i,key:A}=await be(p),I={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0},d=await X(r[0],I);await(async()=>{if(!(await fetch(i,{method:"PUT",headers:{"Content-Type":r[0].type},body:d})).ok)throw new Error("Error during file upload");const h=`${x.IMAGE_CDN}/${p}`;c(!1);const k={imgUrl:h,fileName:r[0].name,fileSize:d.size};m(oe(k))})()}catch(i){console.error("Upload Error:",i),c(!1)}},{acceptedFiles:S,getRootProps:v,getInputProps:w}=J({onDrop:y,accept:{"image/*":[]}});return e.createElement("div",{className:"lg:min-w-[800px] "},e.createElement("div",{className:"file_Upload__header border-b flex justify-between p-4"},e.createElement("h2",{className:"text-gray-600 text-2xl "},"Upload Product Images"),e.createElement("span",{className:"close-icon hover:bg-gray-800 size-10 flex justify-center items-center rounded-full group ease-in duration-75 transition-colors",id:"modal-close",onClick:a},e.createElement(z,{className:"text-gray-300 size-8 cursor-pointer group-hover:text-white"}))),e.createElement("div",{className:"file-upload-wrapper px-4 my-4"},e.createElement("div",{...v({className:"dropzone"}),className:"rounded-md border-2 border-dashed mx-auto w-5/6 my-4 p-6 cursor-copy"},e.createElement("input",{...w()}),e.createElement("p",{className:"text-gray-300"},"Drag 'n' drop some files here, or click to select files")),s&&e.createElement("div",{className:"container border p-3 rounded-md transition-all ease-in mb-2"},e.createElement("div",{className:"flex items-center space-x-2"},e.createElement(b,{className:"h-12 w-12 rounded-md"}),e.createElement("div",{className:"space-y-2"},e.createElement(b,{className:"h-4 w-[250px]"}),e.createElement(b,{className:"h-4 w-[50px]"})))),e.createElement("div",{className:"flex flex-col gap-2"},n&&n.length>=0&&n.map(r=>e.createElement(Y,{File:r,Size:r.fileSize,key:r.id,ImgUrl:r.imgUrl,ISUploading:s})))))},ve=H({name:E().required("Package Name is required."),capacity:E().required("capacity is required."),price:E().required("price is required."),description:E().required("description is required."),notes:E(),policy:E()}),we={pkg_name:"",capacity:"",price:"",notes:"",description:"",file:""},Ie=(a,s)=>{switch(s.type){case"ADD_PKG_NAME":return{...a,pkg_name:s.payload};case"ADD_CAPACITY":return{...a,capacity:s.payload};case"ADD_PRICE":return{...a,price:`â‚¹${s.payload}`};case"ADD_NOTES":return{...a,notes:s.payload};case"ADD_DESC":return{...a,description:s.payload};default:return a}},Me=()=>{var O;const[a,s]=o.useReducer(Ie,we),[c,m]=o.useState(!1),[n,y]=o.useState([]),[S,v]=o.useState(),[w,r]=o.useState(),[p,i]=o.useState(),A=U(t=>t.UploadedImgs.banners),I=U(t=>t.UploadedImgs.productImages),d=o.useMemo(()=>A.map((l,g)=>({imgPath:V(l.imgUrl),order:g+1,title:l.filename,imageType:l.imageType}))),T=o.useMemo(()=>I.map((l,g)=>({imgPath:V(l.imgUrl),order:g+1,title:l.filename,imageType:l.imageType}))),{register:u,handleSubmit:h,reset:k,watch:Se,setValue:Q,formState:{errors:ke,isSubmitSuccessful:De}}=$({mode:"all",resolver:B(ve),defaultValues:{name:"",capacity:"",price:"",description:"",notes:"",packageListTextItems:"",policy:"",PackageListItems:[]}});Q("policy","not available");const Z=localStorage.getItem("AppID"),ee=t=>{if(!S)return;const l=n==null?void 0:n.map(N=>N.packageItem),g={name:t.name,description:t.description,capacity:t.capacity,price:Number(t.price),notes:t.notes,policy:t.policy,packageListTextItems:l,productBannerImgArr:d,productMainImgArr:T,rating:S};if(l.length<=0){_.error("Please list can't be empty");return}(async()=>{try{const N=await fetch(`${x&&x.BACKEND_URL}/api/admin/package/`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Z}`},body:JSON.stringify(g)});N.ok||_("Internal error");const D=await N.json();console.log(D),D!=null&&D.success||_("Opps something wen wrong."),_("New package added successfully..")}catch(N){console.log(N)}})()},ae=H({packageItem:E().min(3).required()}).required("You can't submit without fill the form."),{register:te,handleSubmit:re,formState:{errors:L},reset:se}=$({mode:"all",resolver:B(ae),defaultValues:{PackageListItems:[]}}),ne=t=>{v(t)},le=t=>{y(l=>[...l,{id:Date.now(),packageItem:t.packageItem}]),setTimeout(()=>{se()},100)},F=()=>{r(t=>!t)},M=()=>{i(t=>!t)};return o.useEffect(()=>{console.log("textListItems",n)},[]),e.createElement(e.Fragment,null,e.createElement(me,{richColors:!0}),e.createElement(K,{isModalOpen:w,contentLabel:"banner-ui",id:"product-banner"},e.createElement(fe,{ToggleModal:F})),e.createElement(K,{isModalOpen:p,contentLabel:"banner-ui",id:"product-banner"},e.createElement(xe,{ToggleModal:M})),e.createElement(ue,{open:c,onOpenChange:m},e.createElement(ge,null,e.createElement(Ee,null,e.createElement(ye,null,"Add Package lists items "),e.createElement(he,null,e.createElement("span",{className:"block mb-4 pt-1 border-b"},"Lorem ipsum dolor sit amet consectetur, adipisicing elit."),e.createElement("span",null,n&&n.map(t=>e.createElement("span",{key:t.id,className:"packagesListsWrapper"},e.createElement("span",{className:"bg-neutral-100 rounded p-1 text-lg flex items-center justify-between my-2"},t.packageItem,e.createElement("span",null,e.createElement(z,{className:"size-4   rounded-full text-black cursor-pointer transition-colors ease-out duration-300 hover:bg-orange-300 hover:text-white",onClick:l=>{const g=n.filter(j=>j.id!=t.id);y(g)}})))))),e.createElement("span",null,e.createElement("form",{onSubmit:re(le)},e.createElement("span",{className:"dialog__footer  flex mt-8 "},e.createElement(P,{className:"h-10 focus-visible:ring-offset-0 focus-visible:ring-0 rounded-r-none",placeholder:"Add new package lists item",...te("packageItem")}),e.createElement("button",{type:"submit",className:"bg-orange-400 rounded-md w-12 flex items-center justify-center text-white rounded-l-none"},e.createElement(pe,null))),e.createElement("p",{className:"text-red-400 capitalize mt-1"},L&&((O=L.packageItem)==null?void 0:O.message)))),e.createElement("span",{className:"flex justify-end mt-4 "},e.createElement(C,{className:"bg-orange-400 hover:bg-orange-300 w-32",onClick:()=>m(t=>!t)},"Done")))))),e.createElement("div",{className:"p-20 flex justify-between"},e.createElement("div",{className:"bg-gray-200 p-6 w-[400px] h-auto rounded-lg ",id:"preview_package"},e.createElement("div",{className:"flex flex-col gap-3"},e.createElement(C,{onClick:F,className:"w-full bg-blue-400"},"Upload Banners images"),e.createElement(C,{onClick:M,className:"w-full bg-amber-400"},"Uplaod Product images")),e.createElement("span",{className:"textPackage"},e.createElement("h3",{className:"mt-4 font-medium text-2xl text-wrap"},a&&a.pkg_name),e.createElement("div",{className:"price_Cap"},e.createElement("div",{className:"flex gap-3 justify-end pt-2 pb-3"},a&&a.price?e.createElement(q,{variant:"destructive",className:"bg-orange-500 hover:bg-gray-700"},"Price:",a&&`  ${a.price}`):null,a&&a.capacity?e.createElement(q,{variant:"destructive",className:"bg-black hover:bg-gray-700"},"Capacity:",a&&`  ${a.capacity}`," People"):null),e.createElement("div",{className:"flex flex-col gap-2 "},n&&n.map(t=>e.createElement("div",{key:t.id,className:"flex justify-start items-center gap-2"},e.createElement("span",{className:"bg-green-400 size-4 rounded-full flex justify-center items-center "},e.createElement(ie,{className:"text-white size-3"})),e.createElement("p",{className:"text-neutral-500"},t.packageItem)))),a&&a.description?e.createElement("div",{className:"Policy bg-white rounded-md px-5 py-4 mt-2"},e.createElement("h3",{className:"capitalize font-semibold"},"Description"),a&&a.description):null)),a&&a.notes?e.createElement("div",{className:"Policy bg-white rounded-md px-5 py-4 mt-2"},e.createElement("h3",{className:"capitalize font-semibold"},"Policy"),a&&a.notes):null),e.createElement("div",{className:"bg-neutral-50 rounded-md p-12 w-1/2"},e.createElement("form",{onSubmit:h(ee)},e.createElement("div",{className:"grid gap-4"},e.createElement("div",{className:"grid gap-2"},e.createElement(f,{htmlFor:"name"},"Name"),e.createElement(P,{id:"name",type:"text",placeholder:"Basic Packages",required:!0,className:"py-6",value:a&&a.pkg_name,...u("name"),onChange:t=>{s({type:"ADD_PKG_NAME",payload:t.target.value})}})),e.createElement("div",{className:"grid gap-2"},e.createElement(f,{htmlFor:"capacity"},"Capacity"),e.createElement(P,{id:"capacity",type:"text",placeholder:"100 People",required:!0,className:"py-6",value:a&&a.capacity,...u("capacity"),onChange:t=>{s({type:"ADD_CAPACITY",payload:t.target.value})}})),e.createElement("div",{className:"grid gap-2"},e.createElement(f,{htmlFor:"price"},"Price"),e.createElement(P,{id:"price",type:"text",placeholder:"â‚¹45000",required:!0,className:"py-6",value:a&&a.price.replace("â‚¹",""),...u("price"),onChange:t=>{s({type:"ADD_PRICE",payload:t.target.value})}})),e.createElement("div",{className:"grid-gap-2"},e.createElement(f,{htmlFor:"price"},"Package rating"),e.createElement(de,{count:5,onChange:ne,size:24,activeColor:"#ffd700"})),e.createElement("div",{className:"grid_gap-2"},e.createElement("div",{className:"text-sm text-neutral-400 border w-full text-left rounded-lg p-3 cursor-pointer",onClick:()=>{m(t=>!t)}},"Add Package points")),e.createElement("div",{className:"grid gap-2"},e.createElement(f,{htmlFor:"policy"},"Notes or Policy"),e.createElement(R,{id:"policy",className:"h-2",value:a&&a.notes,...u("notes"),onChange:t=>{s({type:"ADD_NOTES",payload:t.target.value})}})),e.createElement("div",{className:"grid gap-2"},e.createElement(f,{htmlFor:"description"},"Description"),e.createElement(R,{id:"description",placeholder:"Package description..",className:"h-20",value:a&&a.description,...u("description"),onChange:t=>{s({type:"ADD_DESC",payload:t.target.value})}})),e.createElement(C,{type:"submit",className:"bg-theme-color py-6 "},"Add New Package"))))))};export{Me as default};
